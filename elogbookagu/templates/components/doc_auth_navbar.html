<!-- Fixed Header -->
<header class="bg-white dark:bg-gray-800 shadow-md fixed top-0 left-0 right-0 z-50 h-16 flex items-center">
  <div class="flex items-center justify-between w-full px-4">
    <!-- Left section with toggle and logo -->
    <div class="flex items-center">
      <button id="sidebar-toggle" class="p-2 mr-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 lg:hidden">
        <i class="fas fa-bars text-xl"></i>
      </button>
      <div class="flex items-center">
        <i class="fas fa-user-md text-blue-600 dark:text-blue-400 text-2xl mr-2"></i>
        <span class="font-bold text-xl text-gray-800 dark:text-white hidden sm:inline">Doctor Portal</span>
      </div>
    </div>

    <!-- Center section with welcome message -->
    <div class="hidden md:block text-center">
      <h1 class="text-lg font-semibold text-gray-800 dark:text-white">Welcome, Dr. {{ request.session.first_name }} {{ request.session.last_name }}</h1>
    </div>

    <!-- Right section with actions -->
    <div class="flex items-center space-x-4">
      <!-- Notification Icon -->
      <div class="relative">
        <a href="{% url 'doctor_section:notifications' %}" class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors duration-200" aria-label="Notifications">
          <i class="fas fa-bell text-xl"></i>
          {% if unread_notifications_count > 0 %}
            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">{{ unread_notifications_count }}</span>
          {% endif %}
        </a>
      </div>

      <!-- Theme Toggle -->
      <button id="theme-toggle" aria-label="Toggle dark mode" class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors duration-200">
        <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
        </svg>
        <svg id="theme-toggle-light-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
      </button>

      <!-- User Menu (Mobile) -->
      <div class="relative md:hidden">
        <button id="user-menu-button" class="flex items-center text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <span class="sr-only">Open user menu</span>
          <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300 font-semibold">
            {{ request.session.first_name|slice:"0:1" }}
          </div>
        </button>
        <!-- Mobile dropdown menu -->
        <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5">
          <div class="px-4 py-2 text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700">
            <p class="font-semibold">{{ request.session.first_name }} {{ request.session.last_name }}</p>
          </div>
          <a href="{% url 'doctor_section:doctor_profile' %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-user-md mr-2"></i> Profile
          </a>
          <form method="POST" action="{% url 'doctor_section:logout' %}" class="w-full">
            {% csrf_token %}
            <button type="submit" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Sidebar -->
<aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 pt-16 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out lg:translate-x-0">
  <div class="h-full px-3 py-4 overflow-y-auto">
    <!-- User Info (Desktop) -->
    <div class="flex items-center p-2 mb-6 rounded-lg bg-gray-50 dark:bg-gray-700">
      <div class="flex-shrink-0">
        <div class="h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300 font-semibold text-lg">
          {{ request.session.first_name|slice:"0:1" }}
        </div>
      </div>
      <div class="ml-3 overflow-hidden">
        <p class="text-sm font-medium text-gray-900 dark:text-white truncate">Dr. {{ request.session.first_name }} {{ request.session.last_name }}</p>
        <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Doctor</p>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="space-y-1">
      <a href="{% url 'doctor_section:doctor_dash' %}" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200" data-path="doctor_section:doctor_dash">
        <i class="fas fa-chart-line w-5 h-5 text-blue-600 dark:text-blue-400"></i>
        <span class="ml-3 font-medium">Dashboard</span>
      </a>

      <a href="{% url 'doctor_section:doctor_reviews' %}" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200" data-path="doctor_section:doctor_reviews">
        <i class="fas fa-book-reader w-5 h-5 text-blue-600 dark:text-blue-400"></i>
        <span class="ml-3 font-medium">Review Logs</span>
      </a>

      <a href="{% url 'doctor_section:doctor_blogs' %}" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200" data-path="doctor_section:doctor_blogs">
        <i class="far fa-edit w-5 h-5 text-blue-600 dark:text-blue-400"></i>
        <span class="ml-3 font-medium">Posts</span>
      </a>

      <a href="{% url 'doctor_section:doctor_profile' %}" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200" data-path="doctor_section:doctor_profile">
        <i class="fas fa-user-md w-5 h-5 text-blue-600 dark:text-blue-400"></i>
        <span class="ml-3 font-medium">Profile</span>
      </a>

      <a href="{% url 'doctor_section:doctor_help' %}" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200" data-path="doctor_section:doctor_help">
        <i class="fas fa-question-circle w-5 h-5 text-blue-600 dark:text-blue-400"></i>
        <span class="ml-3 font-medium">Help</span>
      </a>

      <form method="POST" action="{% url 'doctor_section:logout' %}" class="w-full mt-6">
        {% csrf_token %}
        <button type="submit" class="flex w-full items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group transition-colors duration-200">
          <i class="fas fa-sign-out-alt w-5 h-5 text-red-600 dark:text-red-400"></i>
          <span class="ml-3 font-medium">Logout</span>
        </button>
      </form>
    </nav>
  </div>
</aside>

<!-- Main Content Wrapper -->
<div id="content-wrapper" class="pt-16 lg:pl-64 min-h-screen transition-all duration-300">
  <!-- This div wraps around the content in base.html -->
</div>

<!-- JavaScript for Sidebar and Theme -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const sidebarToggleBtn = document.getElementById('sidebar-toggle');
    const sidebar = document.getElementById('sidebar');
    const contentWrapper = document.getElementById('content-wrapper');
    const themeToggleBtn = document.getElementById('theme-toggle');
    const darkIcon = document.getElementById('theme-toggle-dark-icon');
    const lightIcon = document.getElementById('theme-toggle-light-icon');
    const userMenuButton = document.getElementById('user-menu-button');
    const userDropdown = document.getElementById('user-dropdown');

    // Sidebar functionality
    if (sidebarToggleBtn && sidebar) {
      sidebarToggleBtn.addEventListener('click', function() {
        sidebar.classList.toggle('-translate-x-full');

        // Add overlay when sidebar is open on mobile
        if (!sidebar.classList.contains('-translate-x-full')) {
          // Create overlay if it doesn't exist
          let overlay = document.getElementById('sidebar-overlay');
          if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'sidebar-overlay';
            overlay.className = 'fixed inset-0 bg-gray-900 bg-opacity-50 z-30 lg:hidden';
            document.body.appendChild(overlay);

            // Close sidebar when clicking overlay
            overlay.addEventListener('click', function() {
              sidebar.classList.add('-translate-x-full');
              overlay.remove();
            });
          }
        } else {
          // Remove overlay when sidebar is closed
          const overlay = document.getElementById('sidebar-overlay');
          if (overlay) overlay.remove();
        }
      });

      // Close sidebar on window resize if screen becomes large
      window.addEventListener('resize', function() {
        if (window.innerWidth >= 1024) { // lg breakpoint
          const overlay = document.getElementById('sidebar-overlay');
          if (overlay) overlay.remove();
        }
      });
    }

    // User dropdown menu (mobile)
    if (userMenuButton && userDropdown) {
      userMenuButton.addEventListener('click', function() {
        userDropdown.classList.toggle('hidden');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function(event) {
        if (!userMenuButton.contains(event.target) && !userDropdown.contains(event.target)) {
          userDropdown.classList.add('hidden');
        }
      });
    }

    // Theme toggle functionality
    if (themeToggleBtn) {
      themeToggleBtn.addEventListener('click', function() {
        // Use the global toggleTheme function from base.html
        if (typeof window.toggleTheme === 'function') {
          window.toggleTheme();
        }
      });
    }

    // Move main content inside wrapper
    function setupContentWrapper() {
      const mainContent = document.querySelector('main');
      if (mainContent && contentWrapper) {
        // Check if content is already wrapped
        if (!contentWrapper.contains(mainContent) && !mainContent.contains(contentWrapper)) {
          // Clone the main content
          const mainClone = mainContent.cloneNode(true);

          // Replace the original main with the wrapper containing the clone
          contentWrapper.appendChild(mainClone);
          mainContent.replaceWith(contentWrapper);
        }
      }
    }

    // Run once on load
    setupContentWrapper();

    // Highlight active navigation item
    function highlightActiveNavItem() {
      const navItems = document.querySelectorAll('.nav-item');
      const currentPath = window.location.pathname;

      navItems.forEach(item => {
        // Remove active class from all items
        item.classList.remove('nav-active');

        // Get the path from the item's href
        const itemPath = item.getAttribute('href');

        // Check if current path matches or starts with this item's path
        // Special case for dashboard which might be just the root path
        if (
          (currentPath === itemPath) ||
          (currentPath.startsWith(itemPath) && itemPath !== '/') ||
          (itemPath.includes('doctor_dash') && (currentPath === '/' || currentPath === ''))
        ) {
          item.classList.add('nav-active');
        }
      });
    }

    // Run highlight on page load
    highlightActiveNavItem();
  });
</script>

<!-- Inline Styles -->
<style>
  /* Ensure proper layout with fixed sidebar */
  body {
    overflow-x: hidden;
  }

  /* Improve form elements styling */
  input:not([type="checkbox"]):not([type="radio"]),
  select,
  textarea {
    @apply px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500;
  }

  .dark input:not([type="checkbox"]):not([type="radio"]),
  .dark select,
  .dark textarea {
    @apply border-gray-600 bg-gray-700 text-white;
  }

  /* Active navigation item */
  .nav-active {
    @apply bg-blue-50 text-blue-700 dark:bg-gray-700 dark:text-blue-400 font-semibold border-l-4 border-blue-600 dark:border-blue-400;
  }

  .nav-active i {
    @apply text-blue-700 dark:text-blue-400;
  }

  /* Improve table styling */
  table {
    @apply w-full border-collapse;
  }

  table th {
    @apply px-4 py-2 bg-gray-100 dark:bg-gray-700 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider;
  }

  table td {
    @apply px-4 py-2 border-t border-gray-200 dark:border-gray-700;
  }

  /* Ensure content has proper padding */
  #content-wrapper > div {
    @apply p-4;
  }
</style>
