{% load static %}
<!DOCTYPE html>

<html lang="en" class="{% if request.session.theme == 'dark' %}dark{% endif %} transition-colors duration-300">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>
      {% block title %}
        My Website
      {% endblock %}
    </title>

    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <!-- Favicon -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.4"></script>
    <script>
      // Function to set the theme based on session or localStorage
      function setTheme() {
        const theme = localStorage.getItem('theme') || '{% if request.session.theme %}{{ request.session.theme }}{% else %}light{% endif %}'
        if (theme === 'dark') {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
      }
      
      // Set the theme on page load
      setTheme()
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">
    {% block navbar %}

    {% endblock %}
    {% block content %}

    {% endblock %}

    {% include './components/footer.html' %}
    <!-- JavaScript for Dark Mode Toggle -->
    <script>
      const themeToggleBtn = document.getElementById('theme-toggle')
      if (themeToggleBtn) {
        // Proceed with the toggle event listener
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon')
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon')
        themeToggleBtn.addEventListener('click', () => {
          // Toggle icons
          themeToggleDarkIcon.classList.toggle('hidden')
          themeToggleLightIcon.classList.toggle('hidden')
      
          // Toggle theme
          const isDarkMode = document.documentElement.classList.toggle('dark')
          localStorage.setItem('theme', isDarkMode ? 'dark' : 'light')
      
          // Optionally send theme preference to the server
          fetch('/set-theme/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ theme: isDarkMode ? 'dark' : 'light' })
          })
        })
      }
    </script>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script src="https://unpkg.com/htmx.org@2.0.4" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" crossorigin="anonymous"></script>
  </body>
</html>
