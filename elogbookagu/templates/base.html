{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <!-- Theme Setup -->
    <!-- In <head> -->
    <script>
      // Apply theme immediately based on localStorage or system preference
      ;(function () {
        const savedTheme = localStorage.getItem('theme')
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
        const isDark = savedTheme === 'dark' || (!savedTheme && prefersDark)
        document.documentElement.classList.toggle('dark', isDark)
      })()
    </script>
    <!-- Styles -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <!-- Add in head section -->
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
  </head>

  <body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300 min-h-screen flex flex-col">
    {% block navbar %}
    <!-- Navigation will be included here -->
    {% endblock %}

    <main class="flex-grow">
      <div class="container mx-auto">
        {% block content %}
        <!-- Content will be rendered here -->
        {% endblock %}
        {% block extra_scripts %}{% endblock %}
      </div>
    </main>

    {% include './components/footer.html' %}

    <!-- In <body> at the bottom -->
      <script>
        function updateTheme(isDark) {
          document.documentElement.classList.toggle('dark', isDark);
          localStorage.setItem('theme', isDark ? 'dark' : 'light');

          // Update icon visibility for theme toggle buttons
          const darkIcons = document.querySelectorAll('[id^="theme-toggle-dark-icon"]');
          const lightIcons = document.querySelectorAll('[id^="theme-toggle-light-icon"]');
          darkIcons.forEach((icon) => icon.classList.toggle('hidden', !isDark));
          lightIcons.forEach((icon) => icon.classList.toggle('hidden', isDark));

          // Dispatch themeChanged event for other components (e.g., Chart.js)
          window.dispatchEvent(new Event('themeChanged'));
        }

        window.toggleTheme = function () {
          const isDark = !document.documentElement.classList.contains('dark');
          updateTheme(isDark);
        };

        // Ensure theme toggle buttons work on page load
        document.addEventListener('DOMContentLoaded', () => {
          const isDark = document.documentElement.classList.contains('dark');
          updateTheme(isDark); // Sync UI with initial state
        });
      </script>
  </body>
</html>
